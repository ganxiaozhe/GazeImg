// ==================================================
// 
// GazeImg.gQuery.js v1.0.0
// (c) 2020-present, JU Chengren (Ganxiaozhe)
//
// Licensed GPLv3 for open source use
// or GazeImg Commercial License for commercial use
//
// ==================================================
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,o,e){if(!t)throw new Error("GazeImg.js need gQuery: https://gquery.net/");console.log("%c GazeImg v1.0.0 %c www.gquery.net/plugins/gazeimg/ \n","color: #fff; background: #030307; padding:5px 0; margin-top: 1em;","background: #efefef; color: #333; padding:5px 0;");var a={s:{close:0,move:0},iloader:function(t){return new Promise(function(o,e){var a=new Image;a.onload=function(){o(a)},a.onerror=function(){e(a)},a.src=t,a.complete&&o(a)})},ishowBind:function(){t("img[data-gishow]").removeAttr("data-gishow").addClass("gi-click").on("click",function(){var o={$i:t(this)};o.src=o.$i.attr("src"),a.show(o.src)})},show:function(o){var e={};e.stage="<div class='gazeimg-container'><div class='gazeimg-bg'></div><div class='gazeimg-inner'><div class='gazeimg-stage'><div class='gazeimg-content'><div class='loader'></div></div></div></div></div>",t("body").append(e.stage).addClass("gi-nobar"),a.showBind(),a.iloader(o).then(function(a){e.$stage=t(".gazeimg-stage"),e.stageW=e.$stage.width(),e.stageH=e.$stage.height(),e.iW=a.width,e.iH=a.height,e.isZoom=0,e.percW=a.width/e.stageW,e.percH=a.height/e.stageH,(e.percW>1||e.percH>1)&&(e.percW>e.percH?(e.iW=e.stageW,e.iH=e.iW/a.width*e.iH):(e.iH=e.stageH,e.iW=e.iH/a.height*e.iW),e.isZoom=1),e.cls=e.isZoom?"zoom-in":"zoom-out",t(".gazeimg-content").data({iW:e.iW,iH:e.iH,inW:a.width,inH:a.height,isZoom:e.isZoom,zoom:0}).html("<img src='"+o+"'/>").css({width:e.iW+"px",height:e.iH+"px"}).addClass(e.cls),t(".gazeimg-content img").on("mousedown",function(t){t.preventDefault()})})},showBind:function(){t(".gazeimg-container").on("click",function(){a.s.close++,setTimeout(function(){1==a.s.close&&a.showClose()},50)}),t(".gazeimg-content").on({click:function(){a.s.close--;var o={$obj:t(this)};if(!(a.s.move>0)){if(1!=o.$obj.data("isZoom"))return void a.showClose();1==o.$obj.data("zoom")?(o.iW=o.$obj.data("iW"),o.iH=o.$obj.data("iH"),o.zoom=0):(o.iW=o.$obj.data("inW"),o.iH=o.$obj.data("inH"),o.zoom=1),o.cls=o.zoom?"grab":"zoom-in",o.$obj.data("zoom",o.zoom).css({width:o.iW+"px",height:o.iH+"px",transform:"translate(0px, 0px)"}).removeClass("zoom-in grab").addClass(o.cls)}},mousedown:a.showMove,mouseup:a.showMoveEnd,touchstart:a.showMove,touchend:a.showMoveEnd})},showMove:function(o){var e=t(this),i={};i.tran=e.css("transform").replace(/[^0-9\-,.]/g,"").split(","),6!=i.tran.length&&(i.tran=[0,0,0,0,0,0]),i.tran=i.tran.map(function(t){return parseInt(t)}),i.evt="touchstart"==o.type?"touchmove.drag":"mousemove.drag",e.addClass("grabbing").on(i.evt,function(t){a.s.move=1,"touchmove"==t.type?(i.L=i.tran[4]+t.targetTouches[0].pageX-o.targetTouches[0].pageX,i.T=i.tran[5]+t.targetTouches[0].pageY-o.targetTouches[0].pageY):(i.L=i.tran[4]+t.pageX-o.pageX,i.T=i.tran[5]+t.pageY-o.pageY),1==e.data("zoom")?e.css({transform:"translate("+i.L+"px,"+i.T+"px)"}):(i.opa=1-Math.abs(parseInt(i.T))/300,i.opa<0&&(i.opa=0),e.css({transform:"translate(0px,"+i.T+"px)",opacity:i.opa})),a.s.pos=i}),a.s.pos=i},showMoveEnd:function(o){var e=a.s.pos,i=t(this);i.off(e.evt).removeClass("grabbing"),setTimeout(function(){a.s.move=0},50),0==i.data("zoom")&&(e.opa<.5?a.showClose():i.css({transform:"translate(0px, 0px)",opacity:1}))},showClose:function(){t(".gazeimg-container .gazeimg-inner").addClass("gia-zoomOut"),t(".gazeimg-content").off(),setTimeout(function(){t(".gazeimg-container").off().remove(),t("body").removeClass("gi-nobar"),a.s.close=0},400)}};t.fn.extend({gazeimg:function(e){e||"object"!==(void 0===e?"undefined":_typeof(e))&&(e={}),Array.isArray(e.bg)||(e.bg=["linear-gradient(to right, #C3E1CA, #E6E1BD)","linear-gradient(to right, #D4D3DD, #EFEFBB)","linear-gradient(120deg, #a1c4fd 0%, #c2e9fb 100%)","linear-gradient(to top, #cfd9df 0%, #e2ebf0 100%)","linear-gradient(to bottom, rgba(255,255,255,0.15) 0%, rgba(0,0,0,0.15) 100%)","linear-gradient(to top, #c1dfc4 0%, #deecdd 100%)","linear-gradient(to top, #d5d4d0 0%, #d5d4d0 1%, #eeeeec 31%, #efeeec 75%, #e9e9e7 100%);"]),this.each(function(o){var a={$i:t(this),w:this.offsetWidth,h:this.offsetHeight,cls:this.className};if(a.src=a.$i.attr("data-gisrc"),a.$i.attr("data-gi-ready",1).removeAttr("data-gisrc"),e.class&&(a.cls=e.class),a.isrc=a.$i.attr("src"),a.isrc)return a.$i.data("giSRC",a.src).attr("data-gi-prepare",1).removeAttr("data-gi-ready"),!0;a.ohtml=this.outerHTML,a.cls=a.cls?" class='"+a.cls+"'":"",a.style=" style='width:"+a.w+"px;height:"+a.h+"px;background:"+e.bg[Math.floor(Math.random()*e.bg.length)]+"'",a.html="<div id='giQL-"+o+"' data-gi-prepare"+a.cls+a.style+"><div class='loader'></div></div>",this.outerHTML=a.html,t("#giQL-"+o).data({giHTML:a.ohtml,giSRC:a.src}).removeAttr("id").addClass("gi-loading")}),t(o).trigger("scroll")}}),t(o).on("scroll.gazeimg",function(){var o={deh:e.documentElement.clientHeight};t("img[data-gi-prepare], div[data-gi-prepare]").each(function(){if(o.ietop=this.getBoundingClientRect().top,o.ietop>=o.deh)return!0;var e={$obj:t(this)};e.src=e.$obj.removeAttr("data-gi-prepare").data("giSRC"),a.iloader(e.src).then(function(){if("img"==e.$obj[0].tagName.toLowerCase())return e.$obj.attr("src",e.src),void a.ishowBind();var o=e.$obj.data("giHTML");e.$obj.ohtml(o),t("img[data-gi-ready]").attr("src",e.src).removeAttr("data-gi-ready"),a.ishowBind()},function(){var t=e.$obj.addClass("gi-loading gi-failed").attr("class");e.$obj.ohtml("<div class='"+t+"'><a href=\""+e.src+'" target="_blank">图片 '+e.src+" 加载失败；</a></div>")})})},{passive:!0}),t("img[data-gisrc]").gazeimg()}(gQuery,window,document);