// ==================================================
// 
// GazeImg.gQuery.min.js v1.1.0
// (c) 2020-present, JU Chengren (Ganxiaozhe)
//
// Licensed GPLv3 for open source use
// or GazeImg Commercial License for commercial use
//
// gquery.net/plugins/gazeimg
//
// ==================================================
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t,a){if(!e)throw new Error("GazeImg.js need gQuery: https://gquery.net/");console.log("%c GazeImg v1.1.0 %c www.gquery.net/plugins/gazeimg/ \n","color: #fff; background: #030307; padding:5px 0; margin-top: 1em;","background: #efefef; color: #333; padding:5px 0;");var i={s:{close:0,move:0,queue:[],index:0},fn:{getTran:function(e){var t=e.css("transform").replace(/[^0-9\-,.]/g,"").split(",");return 6!=t.length&&(t=[0,0,0,0,0,0]),t.map(function(e){return parseInt(e)})}},iloader:function(e){return new Promise(function(t,a){var i=new Image;i.onload=function(){t(i)},i.onerror=function(){a(i)},i.src=e,i.complete&&t(i)})},isizeCalc:function(e){for(var t in e)isNaN(e[t])&&(e[t]=parseInt(e[t].replace("px","")));return e.w=e.ow,e.h=e.oh,e.iz=0,e.percW=e.ow/e.ww,e.percH=e.oh/e.wh,(e.percW>1||e.percH>1)&&(e.percW>e.percH?(e.w=e.ww,e.h=e.w/e.ow*e.oh):(e.h=e.wh,e.w=e.h/e.oh*e.ow),e.iz=1),e},ishowBind:function(){e("img[data-gishow]").each(function(t){var a={$i:e(this)};a.group=a.$i.attr("data-gishow"),a.group&&a.$i.attr("data-gigp",a.group),this.removeAttribute("data-gishow"),this.classList.add("gi-click")}).on("click",function(){var t={i:this,$i:e(this),arr:[],idx:0};t.arr.push(t.$i.attr("src")),t.group=t.$i.attr("data-gigp"),e('img[data-gigp="'+t.group+'"').each(function(e){0==e&&(t.arr.length=0),t.arr.push(this.getAttribute("src")),t.i==this&&(t.idx=e)}),i.show(t.arr,t.idx)})},show:function(t,a){var s={};a||(a=0),i.s.queue=t,i.s.index=a,s.stage="<div class='gazeimg-container'><div class='gazeimg-bg'></div><div class='gazeimg-inner'><div class='gazeimg-nav'><div class='gazeimg-pages'>1 / 1</div></div><div class='gazeimg-stage'><div class='gazeimg-slide current'><div class='gazeimg-content'><div class='loader'></div></div></div></div></div></div>",e("body").append(s.stage).addClass("gi-nobar"),i.sprepare(),i.sbind(),i.sloader(e(".gazeimg-slide.current > .gazeimg-content"),t[a])},sprepare:function(){if(!(i.s.queue.length<2)){var t={$stage:e(".gazeimg-stage")},a=i.s.queue,s=i.s.index;e(".gazeimg-pages").text(s+1+" / "+a.length),e(".gazeimg-container").addClass("grabbing"),e(".gazeimg-slide:not(.current)").remove(),e(".gazeimg-slide.current").css({transform:"translate(0px, 0px)"}),s>0&&(t.$stage.append("<div class='gazeimg-slide prev'><div class='gazeimg-content'><div class='loader'></div></div></div>"),i.sloader(e(".gazeimg-slide.prev > .gazeimg-content"),a[s-1])),s<a.length-1&&(t.$stage.append("<div class='gazeimg-slide next'><div class='gazeimg-content'><div class='loader'></div></div></div>"),i.sloader(e(".gazeimg-slide.next > .gazeimg-content"),a[s+1])),e(".gazeimg-container").removeClass("grabbing x-grabbing")}},sloader:function(t,a){var s={};t.html("<div class='loader'></div>"),s.$stage=e(".gazeimg-stage"),s.stageW=s.$stage.width(),s.stageH=s.$stage.height(),i.iloader(a).then(function(e){var o=i.isizeCalc({ww:s.stageW,wh:s.stageH,ow:e.width,oh:e.height});s.cls=o.iz?"zoom-in":"zoom-out",t.data({iW:o.w,iH:o.h,inW:o.ow,inH:o.oh,isZoom:o.iz,zoom:0}).html("<img src='"+a+"'/>").css({width:o.w+"px",height:o.h+"px"}).addClass(s.cls),t.find("img").on("mousedown",function(e){e.preventDefault()})}).catch(function(e){t.data({isZoom:0,zoom:0}).css({width:"auto"}).html("<div class='dialog'>图片加载失败！</div>")})},sbind:function(){e(".gazeimg-container").on("click",function(){i.s.move>0||(i.s.close++,setTimeout(function(){1==i.s.close&&i.showClose()},50))}),e(".gazeimg-container").on({mousedown:i.slideMove,mouseup:i.slideMoveEnd,touchstart:i.slideMove,touchend:i.slideMoveEnd},".gazeimg-slide"),e(".gazeimg-container").on({click:function(){if(!(i.s.move>0)){i.s.close--;var t={$obj:e(this)};if(1!=t.$obj.data("isZoom"))return void i.showClose();1==t.$obj.data("zoom")?(t.iW=t.$obj.data("iW"),t.iH=t.$obj.data("iH"),t.zoom=0):(t.iW=t.$obj.data("inW"),t.iH=t.$obj.data("inH"),t.zoom=1),t.cls=t.zoom?"grab":"zoom-in",t.$obj.data("zoom",t.zoom).css({width:t.iW+"px",height:t.iH+"px",transform:"translate(0px, 0px)"}).removeClass("zoom-in grab").addClass(t.cls)}},mousedown:i.showMove,mouseup:i.showMoveEnd,touchstart:i.showMove,touchend:i.showMoveEnd},".gazeimg-content")},slideMove:function(s){var o=e(this),r={};"mousedown"==s.type&&1!=s.which||1==o.find(".gazeimg-content").data("zoom")||(r.tran=i.fn.getTran(o),e(".gazeimg-container").addClass("grabbing"),r.evt="touchstart"==s.type?"touchmove.drag":"mousemove.drag",this.setCapture&&this.setCapture(),e(a).on(r.evt,function(a){if("touchmove"==a.type?(r.L=r.tran[4]+a.targetTouches[0].pageX-s.targetTouches[0].pageX,r.T=r.tran[5]+a.targetTouches[0].pageY-s.targetTouches[0].pageY):(r.L=r.tran[4]+a.pageX-s.pageX,r.T=r.tran[5]+a.pageY-s.pageY),r.type||(i.s.move=1,r.type=Math.abs(r.T)>Math.abs(r.L)?"y":"x",i.s.queue.length<2&&(r.type="y"),"x"==r.type&&e(".gazeimg-container").addClass("x-grabbing")),"y"==r.type)r.opa=1-Math.abs(parseInt(r.T))/300,r.opa<0&&(r.opa=0),o.css({transform:"translate(0px,"+r.T+"px)",opacity:r.opa});else{var n=e(".gazeimg-slide.prev"),g=e(".gazeimg-slide.next");r.ww=t.innerWidth,r.xperc=r.L/r.ww,r.xperc<0?i.s.index>=i.s.queue.length-1&&(r.L/=4,r.xperc=0):i.s.index<1&&(r.L/=4,r.xperc=0),o.css({transform:"translate("+r.L+"px,0px)"}),n.css({transform:"translate("+(r.L-r.ww)+"px,0px)"}),g.css({transform:"translate("+(r.L+r.ww)+"px,0px)"})}i.s.slidePos=r}),i.s.slidePos=r)},slideMoveEnd:function(t){var s=i.s.slidePos,o=e(this);if(1!=o.find(".gazeimg-content").data("zoom")&&(e(".gazeimg-container").removeClass("grabbing"),setTimeout(function(){i.s.move=0},50),this.releaseCapture&&this.releaseCapture(),e(a).off(s.evt),"y"==s.type&&(s.opa<.5?i.showClose():o.css({transform:"translate(0px, 0px)",opacity:1})),"x"==s.type)){var r=e(".gazeimg-slide.prev"),n=e(".gazeimg-slide.next");if(Math.abs(s.xperc)<.2)return r.css({transform:"translate("+-s.ww+"px, 0px)"}),o.css({transform:"translate(0px, 0px)"}),n.css({transform:"translate("+s.ww+"px, 0px)"}),void setTimeout(function(){e(".gazeimg-container").removeClass("x-grabbing")},300);if(s.xperc<0)return i.s.index++,o.css({transform:"translate("+-s.ww+"px, 0px)"}),n.css({transform:"translate(0px, 0px)"}),void setTimeout(function(){o.removeClass("current").addClass("prev"),n.removeClass("next").addClass("current"),i.sprepare()},300);i.s.index--,o.css({transform:"translate("+s.ww+"px, 0px)"}),r.css({transform:"translate(0px, 0px)"}),setTimeout(function(){o.removeClass("current").addClass("next"),r.removeClass("prev").addClass("current"),i.sprepare()},300)}},showMove:function(t){var s=e(this),o={};"mousedown"==t.type&&1!=t.which||0==s.data("zoom")||(o.tran=i.fn.getTran(s),s.addClass("grabbing"),o.evt="touchstart"==t.type?"touchmove.drag":"mousemove.drag",this.setCapture&&this.setCapture(),e(a).on(o.evt,function(e){i.s.move=1,"touchmove"==e.type?(o.L=o.tran[4]+e.targetTouches[0].pageX-t.targetTouches[0].pageX,o.T=o.tran[5]+e.targetTouches[0].pageY-t.targetTouches[0].pageY):(o.L=o.tran[4]+e.pageX-t.pageX,o.T=o.tran[5]+e.pageY-t.pageY),s.css({transform:"translate("+o.L+"px,"+o.T+"px)"})}),i.s.pos=o)},showMoveEnd:function(t){var s=i.s.pos,o=e(this);0!=o.data("zoom")&&(o.removeClass("grabbing"),setTimeout(function(){i.s.move=0},50),this.releaseCapture&&this.releaseCapture(),e(a).off(s.evt))},showClose:function(){e(".gazeimg-container").fadeOut(400),e(".gazeimg-container .gazeimg-inner").addClass("gia-zoomOut"),e(".gazeimg-content").off(),setTimeout(function(){e(".gazeimg-container").off().remove(),e("body").removeClass("gi-nobar"),i.s.close=0},400)}};e.fn.extend({gazeimg:function(a){a||"object"!==(void 0===a?"undefined":_typeof(a))&&(a={}),Array.isArray(a.bg)||(a.bg=["linear-gradient(to right, #C3E1CA, #E6E1BD)","linear-gradient(to right, #D4D3DD, #EFEFBB)","linear-gradient(120deg, #a1c4fd 0%, #c2e9fb 100%)","linear-gradient(to top, #cfd9df 0%, #e2ebf0 100%)","linear-gradient(to bottom, rgba(255,255,255,0.15) 0%, rgba(0,0,0,0.15) 100%)","linear-gradient(to top, #c1dfc4 0%, #deecdd 100%)","linear-gradient(to top, #d5d4d0 0%, #d5d4d0 1%, #eeeeec 31%, #efeeec 75%, #e9e9e7 100%);"]),this.each(function(t){var s={$i:e(this),w:this.offsetWidth+"px",h:this.offsetHeight+"px",cls:this.className};if(s.$p=s.$i.parent(),s.src=s.$i.attr("data-gisrc"),s.$i.attr("data-gi-ready",1).removeAttr("data-gisrc"),a.class&&(s.cls=a.class),s.de=s.src.split(" "),s.de.length>1&&(s.src=s.de[0],s._de=s.de[1].split("="),"size"==s._de[0]&&(s._di=s._de[1].replace(/['"]/g,"").split(","),s.calc=i.isizeCalc({ww:s.$p.width(),wh:s.$p.height(),ow:s._di[0],oh:s._di[1]}),s.w=s.calc.w+"px",s.h=s.calc.h+"px")),s.isrc=s.$i.attr("src"),s.isrc)return s.$i.data("giSRC",s.src).attr("data-gi-prepare",1).removeAttr("data-gi-ready"),!0;s.ohtml=this.outerHTML,s.cls=s.cls?" class='"+s.cls+"'":"",s.style=" style='width:"+s.w+";height:"+s.h+";background:"+a.bg[Math.floor(Math.random()*a.bg.length)]+"'",s.html="<div id='giQL-"+t+"' data-gi-prepare"+s.cls+s.style+"><div class='loader'></div></div>",this.outerHTML=s.html,e("#giQL-"+t).data({giHTML:s.ohtml,giSRC:s.src}).removeAttr("id").addClass("gi-loading")}),e(t).trigger("scroll")}}),e(t).on("scroll.gazeimg",function(){var t={deh:a.documentElement.clientHeight};e("img[data-gi-prepare], div[data-gi-prepare]").each(function(){if(t.ietop=this.getBoundingClientRect().top,t.ietop>=t.deh)return!0;var a={$obj:e(this)};a.src=a.$obj.removeAttr("data-gi-prepare").data("giSRC"),a.w=a.$obj.css("width"),a.h=a.$obj.css("height"),i.iloader(a.src).then(function(){if("img"==a.$obj[0].tagName.toLowerCase())return a.$obj.attr("src",a.src),void i.ishowBind();var t=a.$obj.data("giHTML");a.$obj.ohtml(t),e("img[data-gi-ready]").css({width:a.w,height:a.h}).attr("src",a.src).removeAttr("data-gi-ready").addClass("gia-fadeIn"),i.ishowBind()},function(){var e=a.$obj.addClass("gi-loading gi-failed").attr("class");a.$obj.ohtml("<div class='"+e+"'><a href=\""+a.src+'" target="_blank">图片 '+a.src+" 加载失败；</a></div>")})})},{passive:!0}),e("img[data-gisrc]").gazeimg(),e.extend({gazeimg:{show:i.show}})}(gQuery,window,document);