// ==================================================
// 
// GazeImg.gQuery.js v1.0.1
// (c) 2020-present, JU Chengren (Ganxiaozhe)
//
// Licensed GPLv3 for open source use
// or GazeImg Commercial License for commercial use
//
// ==================================================
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,e,o){if(!t)throw new Error("GazeImg.js need gQuery: https://gquery.net/");console.log("%c GazeImg v1.0.1 %c www.gquery.net/plugins/gazeimg/ \n","color: #fff; background: #030307; padding:5px 0; margin-top: 1em;","background: #efefef; color: #333; padding:5px 0;");var a={s:{close:0,move:0},iloader:function(t){return new Promise(function(e,o){var a=new Image;a.onload=function(){e(a)},a.onerror=function(){o(a)},a.src=t,a.complete&&e(a)})},ishowBind:function(){t("img[data-gishow]").removeAttr("data-gishow").addClass("gi-click").on("click",function(){var e={$i:t(this)};e.src=e.$i.attr("src"),a.show(e.src)})},show:function(e){var o={};o.stage="<div class='gazeimg-container'><div class='gazeimg-bg'></div><div class='gazeimg-inner'><div class='gazeimg-stage'><div class='gazeimg-content'><div class='loader'></div></div></div></div></div>",t("body").append(o.stage).addClass("gi-nobar"),a.showBind(),a.iloader(e).then(function(a){o.$stage=t(".gazeimg-stage"),o.stageW=o.$stage.width(),o.stageH=o.$stage.height(),o.iW=a.width,o.iH=a.height,o.isZoom=0,o.percW=a.width/o.stageW,o.percH=a.height/o.stageH,(o.percW>1||o.percH>1)&&(o.percW>o.percH?(o.iW=o.stageW,o.iH=o.iW/a.width*o.iH):(o.iH=o.stageH,o.iW=o.iH/a.height*o.iW),o.isZoom=1),o.cls=o.isZoom?"zoom-in":"zoom-out",t(".gazeimg-content").data({iW:o.iW,iH:o.iH,inW:a.width,inH:a.height,isZoom:o.isZoom,zoom:0}).html("<img src='"+e+"'/>").css({width:o.iW+"px",height:o.iH+"px"}).addClass(o.cls),t(".gazeimg-content img").on("mousedown",function(t){t.preventDefault()})})},showBind:function(){t(".gazeimg-container").on("click",function(){a.s.close++,setTimeout(function(){1==a.s.close&&a.showClose()},50)}),t(".gazeimg-content").on({click:function(){a.s.close--;var e={$obj:t(this)};if(!(a.s.move>0)){if(1!=e.$obj.data("isZoom"))return void a.showClose();1==e.$obj.data("zoom")?(e.iW=e.$obj.data("iW"),e.iH=e.$obj.data("iH"),e.zoom=0):(e.iW=e.$obj.data("inW"),e.iH=e.$obj.data("inH"),e.zoom=1),e.cls=e.zoom?"grab":"zoom-in",e.$obj.data("zoom",e.zoom).css({width:e.iW+"px",height:e.iH+"px",transform:"translate(0px, 0px)"}).removeClass("zoom-in grab").addClass(e.cls)}},mousedown:a.showMove,mouseup:a.showMoveEnd,touchstart:a.showMove,touchend:a.showMoveEnd})},showMove:function(e){var i=t(this),s={};s.tran=i.css("transform").replace(/[^0-9\-,.]/g,"").split(","),6!=s.tran.length&&(s.tran=[0,0,0,0,0,0]),s.tran=s.tran.map(function(t){return parseInt(t)}),this.setCapture&&this.setCapture(),s.evt="touchstart"==e.type?"touchmove.drag":"mousemove.drag",i.addClass("grabbing"),t(o).on(s.evt,function(t){a.s.move=1,"touchmove"==t.type?(s.L=s.tran[4]+t.targetTouches[0].pageX-e.targetTouches[0].pageX,s.T=s.tran[5]+t.targetTouches[0].pageY-e.targetTouches[0].pageY):(s.L=s.tran[4]+t.pageX-e.pageX,s.T=s.tran[5]+t.pageY-e.pageY),1==i.data("zoom")?i.css({transform:"translate("+s.L+"px,"+s.T+"px)"}):(s.opa=1-Math.abs(parseInt(s.T))/300,s.opa<0&&(s.opa=0),i.css({transform:"translate(0px,"+s.T+"px)",opacity:s.opa})),a.s.pos=s}),a.s.pos=s},showMoveEnd:function(e){var i=a.s.pos,s=t(this);s.removeClass("grabbing"),setTimeout(function(){a.s.move=0},50),this.releaseCapture&&this.releaseCapture(),t(o).off(i.evt),0==s.data("zoom")&&(i.opa<.5?a.showClose():s.css({transform:"translate(0px, 0px)",opacity:1}))},showClose:function(){t(".gazeimg-container .gazeimg-inner").addClass("gia-zoomOut"),t(".gazeimg-content").off(),setTimeout(function(){t(".gazeimg-container").off().remove(),t("body").removeClass("gi-nobar"),a.s.close=0},400)}};t.fn.extend({gazeimg:function(o){o||"object"!==(void 0===o?"undefined":_typeof(o))&&(o={}),Array.isArray(o.bg)||(o.bg=["linear-gradient(to right, #C3E1CA, #E6E1BD)","linear-gradient(to right, #D4D3DD, #EFEFBB)","linear-gradient(120deg, #a1c4fd 0%, #c2e9fb 100%)","linear-gradient(to top, #cfd9df 0%, #e2ebf0 100%)","linear-gradient(to bottom, rgba(255,255,255,0.15) 0%, rgba(0,0,0,0.15) 100%)","linear-gradient(to top, #c1dfc4 0%, #deecdd 100%)","linear-gradient(to top, #d5d4d0 0%, #d5d4d0 1%, #eeeeec 31%, #efeeec 75%, #e9e9e7 100%);"]),this.each(function(e){var a={$i:t(this),w:this.offsetWidth,h:this.offsetHeight,cls:this.className};if(a.src=a.$i.attr("data-gisrc"),a.$i.attr("data-gi-ready",1).removeAttr("data-gisrc"),o.class&&(a.cls=o.class),a.isrc=a.$i.attr("src"),a.isrc)return a.$i.data("giSRC",a.src).attr("data-gi-prepare",1).removeAttr("data-gi-ready"),!0;a.ohtml=this.outerHTML,a.cls=a.cls?" class='"+a.cls+"'":"",a.style=" style='width:"+a.w+"px;height:"+a.h+"px;background:"+o.bg[Math.floor(Math.random()*o.bg.length)]+"'",a.html="<div id='giQL-"+e+"' data-gi-prepare"+a.cls+a.style+"><div class='loader'></div></div>",this.outerHTML=a.html,t("#giQL-"+e).data({giHTML:a.ohtml,giSRC:a.src}).removeAttr("id").addClass("gi-loading")}),t(e).trigger("scroll")}}),t(e).on("scroll.gazeimg",function(){var e={deh:o.documentElement.clientHeight};t("img[data-gi-prepare], div[data-gi-prepare]").each(function(){if(e.ietop=this.getBoundingClientRect().top,e.ietop>=e.deh)return!0;var o={$obj:t(this)};o.src=o.$obj.removeAttr("data-gi-prepare").data("giSRC"),a.iloader(o.src).then(function(){if("img"==o.$obj[0].tagName.toLowerCase())return o.$obj.attr("src",o.src),void a.ishowBind();var e=o.$obj.data("giHTML");o.$obj.ohtml(e),t("img[data-gi-ready]").attr("src",o.src).removeAttr("data-gi-ready").addClass("gia-fadeIn"),a.ishowBind()},function(){var t=o.$obj.addClass("gi-loading gi-failed").attr("class");o.$obj.ohtml("<div class='"+t+"'><a href=\""+o.src+'" target="_blank">图片 '+o.src+" 加载失败；</a></div>")})})},{passive:!0}),t("img[data-gisrc]").gazeimg()}(gQuery,window,document);